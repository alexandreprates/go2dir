pushd . > /dev/null

DESTINATION=$HOME/.go2dir
LAST_VERSION=$(curl -s -L -H 'Accept: application/json' https://github.com/alexandreprates/go2dir/releases/latest | cut -d \" -f 6)

mkdir -p $DESTINATION
curl -s -L "https://github.com/alexandreprates/go2dir/archive/$LAST_VERSION.tar.gz" | tar -xzf - -C $DESTINATION --strip 1


function rc_loader() {
  [[ -s $1 ]]  && cat <<-EOS >> $1
# Enable go2 command
[[ -s $HOME/.go2dir/go2dir.sh ]] && source $HOME/.go2dir/go2dir.sh
EOS
}

function create_alias() {
  source /go2dir/go2dir.sh
  go2 -h # Load internal functions

  local LOCATIONS="$HOME/.local/share/go2dir/locations.txt"
  cat $LOCATIONS | while read LINE; do
    if [[ ! $LINE =~ \| ]]; then
        echo "$(__alias_for_dir "$LINE")|$LINE" >> $LOCATIONS.new
    else
        echo "$LINE" >> $LOCATIONS.new
    fi
  done
  mv $LOCATIONS.new $LOCATIONS
}


rc_loader "$HOME/.bashrc"
rc_loader "$HOME/.zshrc"

create_alias

popd > /dev/null

echo -e "\n\nStart new session to enable go2dir!\nAnd Enjoy!"
