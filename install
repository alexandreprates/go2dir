pushd . > /dev/null

DESTINATION=$HOME/.go2dir
LAST_VERSION=$(curl -s -L -H 'Accept: application/json' https://github.com/alexandreprates/go2dir/releases/latest | cut -d \" -f 6)
LOCATIONS="$HOME/.local/share/go2dir/locations.txt"

mkdir -p $DESTINATION
curl -s -L "https://github.com/alexandreprates/go2dir/archive/$LAST_VERSION.tar.gz" | tar -xzf - -C $DESTINATION --strip 1

[[ -s "$HOME/.bashrc" ]] && echo '[[ -s "$HOME/.go2dir/go2dir.sh" ]] && source "$HOME/.go2dir/go2dir.sh"' >> $HOME/.bashrc
[[ -s "$HOME/.zshrc" ]]  && echo '[[ -s "$HOME/.go2dir/go2dir.sh" ]] && source "$HOME/.go2dir/go2dir.sh"' >> $HOME/.zshrc

popd > /dev/null

## migration to named directories
if [ -e $LOCATIONS ] && [ "$LAST_VERSION" \> "2.1.3" ]; then
  cat $LOCATIONS | while read line; do
    if [[ ! $line =~ (^.*)\|(.*$) ]]; then
        NEWLINE="$(basename $line)|$line"
        sed -i "s,$line,$NEWLINE," "$LOCATIONS"
    fi
  done
fi

echo -e "\n\nStart new session to enable go2dir!\nEnjoy!"
